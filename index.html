<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>piTask Editor</title>
    <link rel="stylesheet" type="text/css" href="bower_components/bootstrap/dist/css/bootstrap.css">
    <script src="vendor/jsoneditor.js"></script>
  </head>
  <body>
    <h1>piTask Editor</h1>
    <button id='submit'>Submit (console.log)</button>
    <div class="container">

    <div id='editor_holder'></div>
    </div>

    <script>
      /* global JSONEditor */
      JSONEditor.defaults.theme = 'bootstrap3';
      JSONEditor.defaults.iconlib = 'bootstrap3';
      // Initialize the editor with a JSON schema
      var editor = new JSONEditor(document.getElementById('editor_holder'),{
        ajax:true,
        //no_additional_properties:true,
        schema: {
          $ref: '#/definitions/sequence',
          //defaultProperties: ['type'],
          definitions: {
            sequence:{
              type:'array',
              items: {
                type: 'object',
                allOf: [
                  {$ref:'#/definitions/task'},
                  {$ref:'#/definitions/basicElement'}
                ]
              }
            },
            task:{
              title: 'Task',
              type:'object',
              properties: {
                name: {type:'string',description:'The name of the task, used for recording information.',required:true},
                title: {type:'string',description:'A string to be used as the page title (the name displayed on the tag). It is reset at the end of the task.'}
              },
              oneOf: [
                {$ref:'#/definitions/pipTask', title:'PIP'},
                // {$ref:'#/definitions/questTask', title:'Questionaire'},
                {$ref:'#/definitions/messageTask', title:'Message'}
              ],
              additionalProperties: false
            },
            pipTask: {
              title: 'PIP Task',
              type:'object',
              properties: {
                type: {type:'string', 'enum': ['pip'], options:{hidden:true}},
                script: {type:'string', description:'The actual script object for the quest or pip tasks.'},
                scriptUrl: {type:'string', description:'The url for the quest or pip script.'}
              },
              defaultProperties: ['type','name','scriptUrl']
            },
            messageTask: {
              type:'object',
              properties: {
                type: {type:'string', 'enum': ['message'], options:{hidden:true}},
                template: {type:'string', description:'The actual html to display as a string.'},
                templateUrl: {type:'string', description:'The url for the message html file.'},
                keys: {
                  type:'array',
                  items:{type:'string'},
                  description:'Controls the proceed key: either a key (i.e. \'a\') a keyCode (i.e. 65).'
                }
              },
              defaultProperties: ['type','name','templateUrl']
            },

            basicElement: {
              title: 'Basic element',
              type:'object',
              properties:{
                inherit: {$ref:'#/definitions/basicElement/definitions/inherit'},
                data: {type:'object', options:{no_additional_properties:false}, description:'Sets up some local variables.'},
                merge: {type:'array',uniqueItems: true,format:'table',items:{type:'string'}, description:'Attributes inheritance extends instead of overriding.'},
                regenerateTemplate: {type:'boolean', description:'Regenerate templates each time they are encountered'}
              },
              definitions: {
                inherit: {
                  id: 'inherit',
                  title: 'inherit',
                  type: 'object',
                  format:'grid',
                  properties: {
                    set: {type: 'string',description: 'Which set are we inheriting from.', required:true},
                    type:{type:'string','enum':['random','exRandom','sequential','byData'], description:'The inheritance method.', required:true,defaults:'random'},
                    seed:{type:'string'},
                    repeat:{type:'boolean'}
                  },
                  defaultProperties: ['set','type']

                }
              }
            }
          }
        }
      });

      // Hook up the submit button to log to the console
      document.getElementById('submit').addEventListener('click',function() {
        // Get the value from the editor
        console.log(editor.getValue());
      });
    </script>
  </body>
</html>
